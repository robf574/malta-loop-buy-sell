import{j as a}from"./ui-vendor-KGc3Tmx2.js";import{r as m}from"./react-vendor-FMUcr-E9.js";import{s as t,u as o,A as y,S as g,B as w,C as h,d as f,a as b,b as v}from"./index-PnLDHn3k.js";import{u as k}from"./router-vendor-VgEQHbbm.js";import{B as C,E as S}from"./icons-vendor-Cu8cUUch.js";import{H as A}from"./utils-vendor-rD1T8BKC.js";import"./supabase-vendor-5tOxYv8x.js";import"./query-vendor-BIjNb4qi.js";function T(){const d=k(),[c,l]=m.useState([]),[x,p]=m.useState(!0);m.useEffect(()=>{t.auth.getSession().then(({data:{session:s}})=>{if(!s){d("/auth");return}u()});const e=t.channel("notifications-updates").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications"},()=>{u()}).subscribe();return()=>{t.removeChannel(e)}},[d]);const u=async()=>{try{const{data:{user:e}}=await t.auth.getUser();if(!e)return;const{data:s,error:r}=await t.from("notifications").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(r)throw r;l(s||[])}catch{o.error("Failed to load notifications")}finally{p(!1)}},_=async e=>{try{const{error:s}=await t.from("notifications").update({is_read:!0}).eq("id",e);if(s)throw s;l(r=>r.map(i=>i.id===e?{...i,is_read:!0}:i))}catch{o.error("Failed to mark as read")}},j=async()=>{try{const{data:{user:e}}=await t.auth.getUser();if(!e)return;const{error:s}=await t.from("notifications").update({is_read:!0}).eq("user_id",e.id).eq("is_read",!1);if(s)throw s;l(r=>r.map(i=>({...i,is_read:!0}))),o.success("All notifications marked as read")}catch{o.error("Failed to mark all as read")}},N=e=>{_(e.id),e.related_item_id?d(`/listing/${e.related_item_id}`):e.related_wanted_ad_id&&d(`/wanted/${e.related_wanted_ad_id}`)},n=c.filter(e=>!e.is_read).length;return a.jsx(y,{children:a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(g,{title:"Notifications",subtitle:n>0?`${n} unread notification${n!==1?"s":""}`:void 0}),n>0&&a.jsx(w,{variant:"outline",size:"sm",onClick:j,children:"Mark all as read"})]}),x?a.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"Loading..."}):c.length===0?a.jsx(h,{children:a.jsxs(f,{className:"pt-6 text-center text-muted-foreground",children:[a.jsx(C,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:"No notifications yet"}),a.jsx("p",{className:"text-sm mt-1",children:"We'll notify you about brand matches and messages"})]})}):a.jsx("div",{className:"space-y-3",children:c.map(e=>a.jsxs(h,{className:`cursor-pointer transition-smooth hover:shadow-md ${e.is_read?"":"border-primary/50 bg-primary/5"}`,onClick:()=>N(e),children:[a.jsx(b,{className:"pb-3",children:a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsx(v,{className:"text-base",children:e.title}),!e.is_read&&a.jsx("div",{className:"h-2 w-2 rounded-full bg-primary flex-shrink-0 mt-1.5"})]})}),a.jsxs(f,{className:"space-y-2",children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:e.body}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[a.jsx("span",{children:A(new Date(e.created_at),{addSuffix:!0})}),(e.related_item_id||e.related_wanted_ad_id)&&a.jsx(S,{className:"h-3 w-3"})]})]})]},e.id))})]})})}export{T as default};
