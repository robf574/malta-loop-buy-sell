import{j as e}from"./ui-vendor-KGc3Tmx2.js";import{r as t}from"./react-vendor-FMUcr-E9.js";import{s as l,A as T,C as q,a as K,b as F,c as I,d as R,L as o,I as w,B as m,e as N,u as v}from"./index-CyEITM6U.js";import{S as _,a as H,b as V,c as E,d as z}from"./select-ClqPj7ou.js";import{u as W}from"./router-vendor-jMJ2wIS-.js";import{c as B,X as C}from"./icons-vendor-eQvKQs58.js";import"./supabase-vendor-5tOxYv8x.js";import"./utils-vendor-rD1T8BKC.js";import"./query-vendor-BIjNb4qi.js";const U=["Attard","Balzan","Birgu","Birkirkara","Birżebbuġa","Cospicua","Dingli","Fgura","Floriana","Fontana","Għajnsielem","Għarb","Għargħur","Għasri","Għaxaq","Gudja","Gżira","Ħamrun","Iklin","Kalkara","Kerċem","Kirkop","Lija","Luqa","Marsa","Marsaskala","Marsaxlokk","Mdina","Mellieħa","Mġarr","Mosta","Mqabba","Msida","Mtarfa","Munxar","Nadur","Naxxar","Paola","Pembroke","Pietà","Qala","Qormi","Qrendi","Rabat (Gozo)","Rabat (Malta)","Safi","San Ġwann","San Lawrenz","San Pawl il-Baħar","Sannat","Santa Luċija","Santa Venera","Siġġiewi","Sliema","St. Julian's","Swieqi","Ta' Xbiex","Tarxien","Valletta","Victoria","Xagħra","Xewkija","Xgħajra","Żabbar","Żebbuġ (Gozo)","Żebbuġ (Malta)","Żejtun","Żurrieq"].sort(),M=["Gucci","Louis Vuitton","Prada","Chanel","Dior","Hermès","Versace","Burberry","Fendi","Bottega Veneta","Michael Kors","Coach","Kate Spade","Tory Burch","Ted Baker","AllSaints","Reiss","Maje","Sandro","Zara","H&M","Mango","Massimo Dutti","COS","& Other Stories","Uniqlo","Gap","Banana Republic","Nike","Adidas","Puma","Under Armour","New Balance","Lululemon","Gymshark","Reebok","Next","Marks & Spencer","Topshop","River Island","ASOS","Superdry","French Connection","Armani","Dolce & Gabbana","Max Mara","Diesel","Liu Jo","Pinko","Patrizia Pepe","Gap Kids","Zara Kids","H&M Kids","Next Kids","Petit Bateau","Jacadi","Bonpoint","Tommy Hilfiger","Calvin Klein","Levi's","Ralph Lauren","Lacoste","Hugo Boss","Guess","Desigual"].sort();function te(){const c=W(),[h,p]=t.useState(!1),[d,x]=t.useState(1),[f,k]=t.useState(""),[j,L]=t.useState(""),[n,G]=t.useState([]),[i,A]=t.useState([]),[u,O]=t.useState("");t.useEffect(()=>{l.auth.getSession().then(({data:{session:a}})=>{a||c("/auth")})},[c]);const g=a=>{G(s=>s.includes(a)?s.filter(r=>r!==a):[...s,a])},S=a=>{A(s=>s.includes(a)?s.filter(r=>r!==a):[...s,a])},y=u?M.filter(a=>a.toLowerCase().includes(u.toLowerCase())):M,P=async a=>{a.preventDefault(),x(2)},D=async a=>{a.preventDefault(),p(!0);try{const{data:{user:s}}=await l.auth.getUser();if(!s)throw new Error("Not authenticated");const{error:r}=await l.from("profiles").update({username:f,localities:[j],updated_at:new Date().toISOString()}).eq("id",s.id);if(r)throw r;const{error:b}=await l.from("user_brand_preferences").insert({user_id:s.id,owned_brands:n,wishlist_brands:i});if(b)throw b;v.success("Welcome to Mela Malta!"),c("/")}catch(s){v.error(s.message||"Failed to complete onboarding")}finally{p(!1)}};return e.jsx(T,{showNav:!1,children:e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(q,{className:"w-full max-w-2xl",children:[e.jsxs(K,{children:[e.jsx(F,{children:d===1?"Complete Your Profile":"Your Brand Preferences"}),e.jsx(I,{children:d===1?"Tell us about yourself":"Help us match you with items you'll love (Step 2 of 2)"})]}),e.jsx(R,{children:d===1?e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"username",children:"Username"}),e.jsx(w,{id:"username",type:"text",placeholder:"Choose a unique username",value:f,onChange:a=>k(a.target.value),required:!0,pattern:"^[a-zA-Z0-9_]{3,20}$",title:"3-20 characters, letters, numbers, and underscores only"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"locality",children:"Your Locality"}),e.jsxs(_,{value:j,onValueChange:L,required:!0,children:[e.jsx(H,{children:e.jsx(V,{placeholder:"Select your locality"})}),e.jsx(E,{className:"max-h-[300px]",children:U.map(a=>e.jsx(z,{value:a,children:a},a))})]})]}),e.jsx(m,{type:"submit",className:"w-full",children:"Continue"})]}):e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Brands You Own or Buy"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"We'll alert people looking for these brands"})]}),e.jsx(w,{placeholder:"Search brands...",value:u,onChange:a=>O(a.target.value)}),e.jsx("div",{className:"max-h-[200px] overflow-y-auto border rounded-md p-3 space-y-2",children:y.map(a=>e.jsxs("button",{type:"button",onClick:()=>g(a),className:`w-full text-left px-3 py-2 rounded-md text-sm transition-smooth flex items-center justify-between ${n.includes(a)?"bg-primary text-primary-foreground":"hover:bg-muted"}`,children:[a,n.includes(a)&&e.jsx(B,{className:"h-4 w-4"})]},a))}),n.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(a=>e.jsxs(N,{variant:"secondary",className:"gap-1",children:[a,e.jsx("button",{type:"button",onClick:()=>g(a),className:"hover:bg-destructive/20 rounded-full p-0.5",children:e.jsx(C,{className:"h-3 w-3"})})]},a))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Brands You Want to Own"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"We'll notify you when these brands appear"})]}),e.jsx("div",{className:"max-h-[200px] overflow-y-auto border rounded-md p-3 space-y-2",children:y.map(a=>e.jsxs("button",{type:"button",onClick:()=>S(a),className:`w-full text-left px-3 py-2 rounded-md text-sm transition-smooth flex items-center justify-between ${i.includes(a)?"bg-accent text-accent-foreground":"hover:bg-muted"}`,children:[a,i.includes(a)&&e.jsx(B,{className:"h-4 w-4"})]},a))}),i.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(a=>e.jsxs(N,{className:"gap-1 bg-accent text-accent-foreground",children:[a,e.jsx("button",{type:"button",onClick:()=>S(a),className:"hover:bg-destructive/20 rounded-full p-0.5",children:e.jsx(C,{className:"h-3 w-3"})})]},a))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>x(1),className:"flex-1",children:"Back"}),e.jsx(m,{type:"submit",className:"flex-1",disabled:h,children:h?"Setting up...":"Complete Setup"})]})]})})]})})})}export{te as default};
