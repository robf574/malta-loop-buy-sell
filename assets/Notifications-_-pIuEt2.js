import{j as a}from"./ui-vendor-KGc3Tmx2.js";import{r as m}from"./react-vendor-FMUcr-E9.js";import{s as t,u as o,A as g,B as y,C as h,d as x,a as w,b}from"./index-DxQid8kj.js";import{u as v}from"./router-vendor-jMJ2wIS-.js";import{B as k,E as C}from"./icons-vendor-CsDdOOCw.js";import{H as A}from"./utils-vendor-rD1T8BKC.js";import"./supabase-vendor-5tOxYv8x.js";import"./query-vendor-BIjNb4qi.js";function $(){const d=v(),[l,c]=m.useState([]),[f,p]=m.useState(!0);m.useEffect(()=>{t.auth.getSession().then(({data:{session:s}})=>{if(!s){d("/auth");return}u()});const e=t.channel("notifications-updates").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications"},()=>{u()}).subscribe();return()=>{t.removeChannel(e)}},[d]);const u=async()=>{try{const{data:{user:e}}=await t.auth.getUser();if(!e)return;const{data:s,error:r}=await t.from("notifications").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(r)throw r;c(s||[])}catch{o.error("Failed to load notifications")}finally{p(!1)}},j=async e=>{try{const{error:s}=await t.from("notifications").update({is_read:!0}).eq("id",e);if(s)throw s;c(r=>r.map(i=>i.id===e?{...i,is_read:!0}:i))}catch{o.error("Failed to mark as read")}},_=async()=>{try{const{data:{user:e}}=await t.auth.getUser();if(!e)return;const{error:s}=await t.from("notifications").update({is_read:!0}).eq("user_id",e.id).eq("is_read",!1);if(s)throw s;c(r=>r.map(i=>({...i,is_read:!0}))),o.success("All notifications marked as read")}catch{o.error("Failed to mark all as read")}},N=e=>{j(e.id),e.related_item_id?d(`/listing/${e.related_item_id}`):e.related_wanted_ad_id&&d(`/wanted/${e.related_wanted_ad_id}`)},n=l.filter(e=>!e.is_read).length;return a.jsx(g,{children:a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Notifications"}),n>0&&a.jsxs("p",{className:"text-sm text-muted-foreground",children:[n," unread notification",n!==1?"s":""]})]}),n>0&&a.jsx(y,{variant:"outline",size:"sm",onClick:_,children:"Mark all as read"})]}),f?a.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"Loading..."}):l.length===0?a.jsx(h,{children:a.jsxs(x,{className:"pt-6 text-center text-muted-foreground",children:[a.jsx(k,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:"No notifications yet"}),a.jsx("p",{className:"text-sm mt-1",children:"We'll notify you about brand matches and messages"})]})}):a.jsx("div",{className:"space-y-3",children:l.map(e=>a.jsxs(h,{className:`cursor-pointer transition-smooth hover:shadow-md ${e.is_read?"":"border-primary/50 bg-primary/5"}`,onClick:()=>N(e),children:[a.jsx(w,{className:"pb-3",children:a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsx(b,{className:"text-base",children:e.title}),!e.is_read&&a.jsx("div",{className:"h-2 w-2 rounded-full bg-primary flex-shrink-0 mt-1.5"})]})}),a.jsxs(x,{className:"space-y-2",children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:e.body}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[a.jsx("span",{children:A(new Date(e.created_at),{addSuffix:!0})}),(e.related_item_id||e.related_wanted_ad_id)&&a.jsx(C,{className:"h-3 w-3"})]})]})]},e.id))})]})})}export{$ as default};
